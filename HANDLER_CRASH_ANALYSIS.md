# Анализ проблемы с Next.js Handler

## Проблема

- ✅ Next.js загружается успешно
- ✅ Next.js app создаётся успешно
- ✅ `prepare()` завершается успешно
- ❌ При попытке использовать handler процесс падает с Internal Server Error

## Возможные причины

### 1. Ограничения памяти (LVE limits)

На shared hosting (Verpex) могут быть ограничения памяти, которые убивают процесс при попытке загрузить Next.js страницы.

**Решение:**
- Обратиться в поддержку Verpex для увеличения лимитов памяти
- Проверить текущие лимиты в cPanel

### 2. Проблемы с basePath

Если `NEXT_PUBLIC_BASE_PATH` не установлен, но Next.js ожидает его, это может вызвать проблемы.

**Решение:**
- Убедиться, что `NEXT_PUBLIC_BASE_PATH` установлен правильно (пустая строка для поддомена)
- Проверить конфигурацию в `next.config.ts`

### 3. Повреждённые файлы .next

Файлы в `.next` могут быть повреждены или неполны.

**Решение:**
- Пересобрать проект: `npm run build`
- Убедиться, что все файлы загружены на сервер

### 4. Проблемы с системными вызовами

Next.js может пытаться выполнить системные вызовы, которые блокируются на shared hosting.

**Решение:**
- Проверить логи сервера
- Обратиться в поддержку Verpex

### 5. Проблемы с загрузкой модулей

При первом запросе Next.js может пытаться загрузить модули, которые вызывают падение.

**Решение:**
- Проверить, все ли зависимости установлены
- Попробовать использовать standalone режим

## Что делать дальше

1. **Проверить логи:**
   - В cPanel → Error Log
   - В File Manager → `logs/nodejs/` (если есть)

2. **Попробовать пересобрать:**
   - Локально: `npm run build`
   - Загрузить `.next` на сервер

3. **Проверить конфигурацию:**
   - Убедиться, что `NEXT_PUBLIC_BASE_PATH` установлен правильно
   - Проверить `next.config.ts`

4. **Обратиться в поддержку Verpex:**
   - Сообщить о проблеме с Next.js handler
   - Попросить проверить лимиты памяти
   - Попросить проверить логи сервера

## Текущий статус

- `server-safe.js` работает в диагностическом режиме
- Handler отключён, чтобы предотвратить падения
- Диагностика показывает, что Next.js готов, но handler вызывает падения

