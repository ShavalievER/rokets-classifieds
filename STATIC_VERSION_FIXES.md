# Исправления для статичной версии

## Проблемы, которые были исправлены

### 1. Адреса доставки исчезли
**Проблема:** API route `/api/account/addresses` не работает в статичной версии.

**Решение:** 
- Создан `lib/demo/client-storage.ts` - использует localStorage для хранения данных
- Создан `lib/demo/client-api.ts` - предоставляет тот же интерфейс, что и API routes, но использует localStorage
- Обновлен `components/account/delivery-addresses.tsx` - использует клиентские API

### 2. Платежные средства исчезли
**Проблема:** API route `/api/account/payment-methods` не работает в статичной версии.

**Решение:**
- Используется тот же подход с `client-storage.ts` и `client-api.ts`
- Обновлен `components/account/payment-methods.tsx` - использует клиентские API

### 3. Расчет стоимости доставки не работает
**Проблема:** API route `/api/rockets/quote` не работает в статичной версии.

**Решение:**
- Добавлена функция `getDeliveryQuote()` в `client-api.ts` - mock расчет стоимости доставки
- Обновлен `components/rockets/DeliveryWidget.tsx` - сначала пытается использовать API, затем fallback на клиентский расчет

### 4. Невозможно положить в корзину
**Проблема:** Server Actions (`'use server'`) не работают в статичной версии.

**Решение:**
- Обновлен `components/cart/add-to-cart.tsx` - server action опционален, основная логика работает через `addCartItem` (клиентская)
- Обновлен `components/rockets/DeliveryWidget.tsx` - аналогично, server action опционален

## Как это работает

### Клиентское хранилище (localStorage)
- Адреса сохраняются в `localStorage` под ключом `rokets_addresses`
- Платежные методы сохраняются в `localStorage` под ключом `rokets_payment_methods`
- При первом запуске загружаются дефолтные данные

### Fallback механизм
Все компоненты сначала пытаются использовать API routes / Server Actions, но если они недоступны (статичная версия), автоматически переключаются на клиентскую логику.

### Совместимость
- **Нестатичная версия:** Использует API routes и Server Actions (как раньше)
- **Статичная версия:** Использует localStorage и клиентскую логику

## Тестирование

1. **Проверьте адреса:**
   - Откройте `/account`
   - Должны отображаться дефолтные адреса
   - Попробуйте добавить новый адрес

2. **Проверьте платежные методы:**
   - Откройте `/account`
   - Должны отображаться дефолтные платежные методы
   - Попробуйте добавить новый метод

3. **Проверьте расчет доставки:**
   - Откройте страницу товара
   - Выберите адрес доставки
   - Должна появиться стоимость доставки

4. **Проверьте добавление в корзину:**
   - Откройте страницу товара
   - Нажмите "Add to Cart"
   - Товар должен добавиться в корзину

## Важные замечания

1. **Данные хранятся в браузере** - при очистке localStorage данные будут потеряны
2. **Mock расчет доставки** - в статичной версии используется упрощенный расчет, не реальный API
3. **Корзина работает клиентски** - данные корзины также хранятся в браузере

## Следующие шаги

Если нужна полная функциональность (реальные API, серверная логика), используйте **нестатичную версию** (ветка `dynamic`).










